if !isdir(joinpath(@__DIR__,"../user_defaults"))
    mkdir(joinpath(@__DIR__,"../user_defaults"))
    open(joinpath(@__DIR__,"../user_defaults/user_defaults.jl"), "w") do f
      write(f,"#Generated by DFControl.")
    end
end

using Conda
using BinDeps


# Conda.add("PyCifRW")
tarpath = joinpath(@__DIR__, "cif2cell.tar.gz")
tarpath2 = joinpath(@__DIR__, "pycifrw.tar.gz")
download("https://10gbps-io.dl.sourceforge.net/project/cif2cell/cif2cell-1.2.10.tar.gz", tarpath)
download("https://pypi.python.org/packages/f9/95/dd59d9c62c76f90110913d28910c81c563fb6db1e2c9fc668eac43c96a75/PyCifRW-4.1.1.tar.gz#md5=2435f47a1a7a935d43c8402d8f4339d5", tarpath2)
run(unpack_cmd("cif2cell.tar.gz", @__DIR__, ".gz",".tar"))
run(unpack_cmd("pycifrw.tar.gz", @__DIR__, ".gz",".tar"))
pythonpath = joinpath(Conda.PYTHONDIR, "python2")
cd(joinpath(@__DIR__, "cif2cell-1.2.10"))
run(`$pythonpath setup.py install --prefix=$(@__DIR__)`)
cd(joinpath(@__DIR__, "PyCifRW-4.1.1"))
run(`$pythonpath setup.py install`)

cp(joinpath(@__DIR__, "lib/python2.7/site-packages/elementdata.py"),joinpath(@__DIR__, "bin/elementdata.py"))
cp(joinpath(@__DIR__, "lib/python2.7/site-packages/ESPInterfaces.py"),joinpath(@__DIR__, "bin/ESPInterfaces.py"))
cp(joinpath(@__DIR__, "lib/python2.7/site-packages/spacegroupdata.py"),joinpath(@__DIR__, "bin/spacegroupdata.py"))
cp(joinpath(@__DIR__, "lib/python2.7/site-packages/uctools.py"),joinpath(@__DIR__, "bin/uctools.py"))
cp(joinpath(@__DIR__, "lib/python2.7/site-packages/utils.py"),joinpath(@__DIR__, "bin/utils.py"))
rm(tarpath)
rm(tarpath2)
rm(joinpath(@__DIR__,"PyCifRW-4.1.1"),recursive=true)
rm(joinpath(@__DIR__,"cif2cell-1.2.10"),recursive=true)
