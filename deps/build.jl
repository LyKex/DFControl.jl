if !isdir(joinpath(@__DIR__,"../user_defaults"))
    mkdir(joinpath(@__DIR__,"../user_defaults"))
end
if !ispath(joinpath(@__DIR__,"../user_defaults/user_defaults.jl"))
    open(joinpath(@__DIR__,"../user_defaults/user_defaults.jl"), "w") do f
        write(f,"#Generated by DFControl.")
    end
end

using Conda
using BinDeps
using Pkg

tarpath = joinpath(@__DIR__, "cif2cell.tar.gz")
tarpath2 = joinpath(@__DIR__, "pycifrw.tar.gz")
download("https://sourceforge.net/projects/cif2cell/files/latest/download", tarpath)
run(unpack_cmd("cif2cell.tar.gz", @__DIR__, ".gz",".tar"))
pythonpath = joinpath(Conda.PYTHONDIR, "python")
depsdir = @__DIR__
cif2celldir = joinpath(depsdir, "cif2cell-1.2.10")
cd(cif2celldir)
run(`$pythonpath setup.py install --prefix=../`)
cp(joinpath(depsdir, "lib/python2.7/site-packages/elementdata.py"),joinpath(depsdir, "bin/elementdata.py"))
cp(joinpath(depsdir, "lib/python2.7/site-packages/ESPInterfaces.py"),joinpath(depsdir, "bin/ESPInterfaces.py"))
cp(joinpath(depsdir, "lib/python2.7/site-packages/spacegroupdata.py"),joinpath(depsdir, "bin/spacegroupdata.py"))
cp(joinpath(depsdir, "lib/python2.7/site-packages/uctools.py"),joinpath(depsdir, "bin/uctools.py"))
cp(joinpath(depsdir, "lib/python2.7/site-packages/utils.py"),joinpath(depsdir, "bin/utils.py"))
rm(tarpath)
rm(joinpath(depsdir,"cif2cell-1.2.10"),recursive=true)
